{% extends "base.html" %}

{% block title %}Order Detail{% endblock %}


{% block content %}
{% if orderdetail_list %}

<style>
.gel_row {
  grid-template-columns: 1fr 3em 3em 3em;
}

.gel_row > div.not_ready {
  background-color:  pink;
}
.gel_row > div.half_ready {
  background-color:  gold;
}

.gel_row > div.ready {
  background-color:  springgreen;
}

</style>

<div class="gel_table">
  <div class="gel_thead">
    <div>{{order.reference}} (<span id="id_order">{{order.id_order}}</span>) {{order.firstname}} {{order.lastname}} {{order.is_new}}</div>
    <div class="gel_row">
      <div>reference / ean13</div>
      <div>units</div>
      <div>qnt</div>
      <div></div>
    </div>
  </div>

  <div class="gel_tbody">
  {% for order in orderdetail_list %}
    <div class="product_row gel_row">
      <div>{{order.product_reference}}<br>
        {{order.product_name}}<br>
        <span class="ean13_col">{{order.product_ean13}}</span> (<span class="id_product">{{order.id_product}}</span>)
      </div>
      <div class="qnt_col">{{order.unity}}</div>
      <div><span class="product_quantity">{{order.product_quantity}}</span> / <span class="ready_quantity">0</span></div>
      <div class="checkbox not_ready"><input type="checkbox"></div>
    </div>
  {% endfor %}
  </div>
</div>
  {% else %}
    <p>There are no orders.</p>
  {% endif %}     
{% endblock content %}



{% block javascript %}
{{ super() }}
<script>

$('input[type=checkbox]').change(function(){
  console.log('change:'+this.checked);

  console.log($(this).parents('div.gel_row').find('.product_quantity').text());

  if (this.checked) {
    $(this).parent('div').removeClass('not_ready');
    $(this).parent('div').removeClass('half_ready');
    $(this).parent('div').addClass('ready');
  }
  else {
    $(this).parent('div').removeClass('ready');
    $(this).parent('div').removeClass('not_ready');
    $(this).parent('div').addClass('half_ready');
  }

})

function process(code) {
  //alert(code);
  $('.product_row').each(function(){
    tt = $(this).find('.ean13_col');
    console.log( tt );
    console.log( tt[0] );
    ttt = tt.text()
    console.log( '? ' + ttt + ' == ' + code);
    if (ttt==code) {
      console.log( "!!!!");
      $(this).find('input[type=checkbox]').prop('checked',true)
    }
  });
}


var code='';
  $( "body" ).keyup(function( event ) {
    console.log( event.originalEvent.key + ' --- ' + code);
  
    if (event.originalEvent.key=='0' ||
        event.originalEvent.key=='1' ||
        event.originalEvent.key=='2' ||
        event.originalEvent.key=='3' ||
        event.originalEvent.key=='4' ||
        event.originalEvent.key=='5' ||
        event.originalEvent.key=='6' ||
        event.originalEvent.key=='7' ||
        event.originalEvent.key=='8' ||
        event.originalEvent.key=='9') {
          code += event.originalEvent.key;
    }
  
    else if (event.originalEvent.key=='Enter' && code.length==13) {
      process(code);
      code = '';
    }
    else {
      code = '';
    }
  
  });
  </script>
{% endblock %}
